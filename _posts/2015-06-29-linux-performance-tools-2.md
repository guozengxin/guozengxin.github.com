---
layout: post
title: "Linux性能分析工具(二) - vmstat命令"
description: "linux性能优化工具介绍（2），vmstat命令"
category: 性能优化
tags: [性能优化, linux, vmstat]
comments: true
---

## vmstat简介

vmstat命令是一个常用的linux性能监控工具，可以对CPU，内存，swap，IO进行监控。和top命令不同的是，vmstat是对整个机器的性能进行监控，而不是单个进程，用在不同的场景。

## vmstat使用示例

在linux命令行下，直接键入vmstat命令可以得到如下的输出：

	# vmstat 
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
	r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	0  0 593136 414880 495560 5536520    0    0    19    17    0    0  4  2 94  0  0

<!-- more -->

在这个结果中

- `r`表示当前正在有多少个进程在使用CPU，当这个值超过了机器CPU的数目，就表示CPU负载过高。
- `b`表示阻塞的进程数目
- `swpd`显示已经使用的虚拟内存的大小
- `free`空闲的物理内存的大小
- `buff`系统缓存占用的大小
- `cache`系统文件缓冲区占用的大小
- `si`每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常
- `so`每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上
- `bi`每秒从块设备上接收的块的数目，**块设备**是指系统上所有的磁盘和其他块设备
- `bo`每秒向块设备上发送的块的数目
- `in`每秒CPU的中断次数，包括时间中断
- `cs`每秒上下文切换的次数，这个值如果太大，说明CPU在上下文切换消耗了太多的时间，即调用了过多的系统函数，或者进行了太多了线程、进程的切换，这样是很耗费系统资源的，此时应该做一些减小系统进程数，减小IO操作等等
- `us`用户调用耗费的时间
- `sy`系统调用耗费的时间，这个值太高说明进行了太多的系统调用
- `id`空间CPU时间，一般认为，`id + sy + id = 100`，id是CPU空闲率，us是用户CPU使用率，sy是内核CPU使用率
- `wa`等待IO的时间消耗
- `st`被虚拟设备偷走的时间

## vmstat的常用参数

示例1：每2秒输出一个结果

	# vmstat 2
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
	r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	0  0 593136 408084 495780 5542264    0    0    19    17    0    0  4  2 94  0  0
	0  0 593136 408076 495780 5542264    0    0     0     1   98   93  0  0 100  0  0
	0  0 593136 408200 495780 5542264    0    0     0     0   84   84  0  0 100  0  0

示例2：每1秒输出一个结果，打印5次

	# vmstat 1 5
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
	r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	0  0 593136 407456 495780 5542484    0    0    19    17    0    0  4  2 94  0  0
	0  0 593136 407448 495780 5542484    0    0     0     0  111   84  0  0 100  0  0
	3  0 593136 400628 495780 5542484    0    0     0    36 2044 1063  1  3 96  0  0
	2  0 593136 401720 495780 5542512    0    0     0     8 10689 4356  3 20 77  0  0
	13  0 593136 395904 495780 5542532    0    0     0     1  996  481  0  3 96  0  0

示例3：打印时间戳

	# vmstat -t 1
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------ ---timestamp---
	r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	0  0 593136 407580 495780 5542600    0    0    19    17    0    0  4  2 94  0  0       2015-06-29 17:51:47 CST
	0  0 593136 407580 495780 5542600    0    0     0    10  550  420  0  0 100  0  0      2015-06-29 17:51:48 CST
	0  0 593136 407324 495780 5542600    0    0     0    24   85  103  0  0 100  0  0      2015-06-29 17:51:49 CST
