---
layout: post
title: "Linux性能分析工具(一) - top命令"
description: "linux性能优化工具介绍（1），介绍top命令。"
category: 性能优化
tags: [性能优化，linux, top]
comments: true
---

## 性能分析

在软件工程中，性能分析（performance analysis也称为profiling），是以收集程序运行时信息为手段研究程序行为的分析方法，是一种动态程序分析的方法。

影响程序的点包括CPU、内存、磁盘IO、网络等，只有了解是否某个硬件达到了瓶颈，才能更好的着手对程序进行优化。要诊断性能问题需要借助一些工具，本篇将介绍一些帮助分析性能瓶颈的工具。

## top简介

top是一个综合性的工具，能显示CPU、内存等的实时统计数据。但是它本身的开销比较大，当系统负载较高的时候很可能会卡住。

top动态显示CPU、内存的情况，默认情况下，5秒钟刷新一次。

## top输出

	top - 14:22:05 up 545 days, 18:55,  2 users,  load average: 0.11, 0.14, 0.16
	Tasks: 299 total,   1 running, 297 sleeping,   0 stopped,   1 zombie
	Cpu(s):  0.6%us,  4.7%sy,  0.0%ni, 94.8%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
	Mem:   7897176k total,  7547768k used,   349408k free,   492952k buffers
	Swap:  4194296k total,   592040k used,  3602256k free,  5689664k cached

	  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
	 9854 root      20   0 13272 1328  900 R  0.7  0.0   0:00.15 top
	15848 root      20   0  398m  13m 3128 S  0.7  0.2   0:05.03 python2.7
	   31 root      RT   0     0    0    0 S  0.3  0.0  28:06.05 migration/7 
	   38 root      20   0     0    0    0 S  0.3  0.0  37:42.89 events/3
	   40 root      20   0     0    0    0 S  0.3  0.0  44:27.95 events/5
	29892 fangzi    20   0  146m  21m 5164 S  0.3  0.3   0:51.55 checktvmao

<!-- more -->

top的输出如上，前5行代表了系统的总体统计信息。

第1行： 系统时间、系统运行时间、当前登录用户数、系统负载（三个数分别是1分钟、5分钟、15分钟系统的平均负载），一般情况下，机器负载超过系统的CPU核心数时就认为机器负载过高，需要对机器减负

第二行：`299 total`总任务数、`1 running`1个正在运行的任务、`297 sleeping`睡眠的进程数、`0 stopped`停止的进程数、`1 zombie`全局进程数。

第三行：`0.6%us`用户空间占用CPU百分比，`4.7%sy`内核空间占用CPU百分比，`0.0%ni`用户进程空间内改变过优先级的进程占用CPU百分比，`94.8%id`空间的CPU百分比，`0.0%wa`等待输入输出的CPU时间百分比，`0.0%hi`服务中断，`0.0%si`服务软中断，`0.0%st`运行在其他虚机的时间（steal）。

第四行：内存信息，`total`总内存，`used`使用的内存，`free`空闲的内存，`buffers`内核缓存。

第五行：交换区信息，`total`交换区问题，`used`使用量，`free`空闲量，`cached`缓冲的交换区量。

top输出从第6行开始显示了各进程的统计信息，各列的含义分别是：

- `PID` 进程ID
- `USER` 进程所有者
- `PR` 优先级
- `NI` nice值，正值表示高优先级，负值表示低优先级
- `VIRT` 进程使用的虚拟内存总量
- `RES` 进程使用的未被换出的实存的总量
- `SHR` 共享内存大小
- `S` 进程状态（D-不可中断的睡眠状态，R-运行，S-睡眠，T-跟踪或停止，Z-僵尸进程）
- `%CPU` 上次更新到现在的CPU百分比
- `%MEM` 进程使用的实存百分比
- `TIME+` 进程使用的CPU时间，单位1/100秒
- `COMMAND` 命令行/程序名

## top参数

- `-d` 指定刷新时间间隔
- `-p` 指定进程ID
- `-S` 使用累计模式
- `-s` 在安全模式中运行
- `-H` 显示线程
- `-i` 不显示闲置进程和僵尸进程
- `-c` 显示整个命令行而不是只显示命令名

## top交互命令

top命令有一些交互命令可以使用，熟练掌握交互对使用有很大帮助。

- `k` 终止一个进程
- `i` 不显示闲置进程和僵尸进程
- `q` 退出
- `S` 切换到累计模式
- `s` 改变两次刷新之间的延迟时间
- `M` 按内存使用大小排序
- `P` 按CPU百分比大小排序
- `T` 根据时间/累计时间排序
